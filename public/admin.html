<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style2.css">
    <title>Admin Page</title>
</head>
<body>
    <header>
        <h2>Admin Page</h2>
        <p class="button" id="logout-button" onclick="logout()">Logout</p>
    </header>
    <div class="container">
        <div id="expand-buttons">
            <p class="button" id="score-mgmt-button">Expand Score Management</p>
            <p class="button" id="analytics-button">Expand Analytics</p>
            </div>
        <div id="score-mgmt" hidden="true">
            <form><table id="table"></table><button type="submit">Save</button></form>
        </div>
        <div id="analytics" hidden="true">
            <p>hi 2</p>
        </div>
    </div>
    <script>const fetchAPI=async(e,t={},a="GET")=>{let s="POST"===a?{method:a,body:JSON.stringify(t),headers:{Accept:"application/json"},credentials:"same-origin"}:{method:a,headers:{Accept:"application/json",'Content-Type':'application/json'},credentials:"same-origin"},n=await fetch(`/api/${e}`,s);switch(n.status){case 400:return await n.text();case 204:return;default:return n.json()}}
    </script>
    <script>
        const scoreMgmt = document.getElementById("score-mgmt");
        const analytics = document.getElementById("analytics");
        const scoreMgmtButton = document.getElementById("score-mgmt-button");
        const analyticsButton = document.getElementById("analytics-button");
        const table = document.getElementById("table")
        document.getElementById("score-mgmt-button").addEventListener("click", async (e) =>{
            
            if (scoreMgmt.hidden) {
                if (!scoreMgmt.firstElementChild.firstElementChild.firstElementChild) await genScoreData();
                scoreMgmtButton.classList.add("selected")
                analyticsButton.classList.remove("selected")
                scoreMgmt.hidden = false;
                analytics.hidden = true; 
            } else {
                scoreMgmtButton.classList.remove("selected")
                analyticsButton.classList.remove("selected")
                scoreMgmt.hidden = true;
                analytics.hidden = true;
            }
        });
        document.getElementById("analytics-button").addEventListener("click", (e) =>{
            
            if (analytics.hidden) {
                scoreMgmtButton.classList.remove("selected")
                analyticsButton.classList.add("selected")
                scoreMgmt.hidden = true;
                analytics.hidden = false; 
            } else {
                scoreMgmtButton.classList.remove("selected")
                analyticsButton.classList.remove("selected")
                scoreMgmt.hidden = true;
                analytics.hidden = true;
            }
        })

        const logout = async () => {
            await fetch("/admin/logout", {method: "GET"});
            window.location.reload();
        }

        const genScoreData = async () => {
            let teams = await fetchAPI("teams");
            for (let i = 0; i<teams.length;i++) {
                genDiv(teams[i])
            }     
        }

        const genDiv = (team) => {
            let s=document.createElement("tr");
            s.className="team"
            s.innerHTML=`<td class="name">${team.name}</td><td class="scores"><input value="${team.scores}" type="number"/></td>`
            table.appendChild(s)
        }
        
    

    </script>
</body>
</html>